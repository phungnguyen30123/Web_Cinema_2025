@startuml Web_Cinema_Class_Diagram
!theme plain
title Web Cinema - Class Diagram
note as N1
 **Database Tables:**
 user, movie, movie_category, room, calendar, booking, comment, momo, vnpay
end note

left to right direction

' ===== ENTITY CLASSES =====

class User {
  - id: int <<PK>>
  - email: String
  - password: String
  - fullname: String
  - birthday: String
  - sdt: String
  - address: String
  - is_admin: int (0/1)
  - created: DateTime
  - modified: DateTime
  --
  + indexlogin()
  + login()
  + indexregister()
  + register()
  + logout()
  + insertData_controller()
  + indextaikhoan()
  + updatedulieu()
}

class Movie {
  - id: int <<PK>>
  - title: String
  - duration: String
  - director: String
  - actor: String
  - language: String
  - country: String
  - description: Text
  - open_date: Date
  - category: String <<FK>>
  - poster: String
  - image1, image2, image3, image4: String
  - imgtra1, imgtra2: String
  - trailer1, trailer2: String
  --
  + getDatabasePhim()
  + getDatabasePhimDC()
  + getDatabasePhimSC()
  + getinfophim($id)
  + getDatabasePhimById($id)
  + updatePhimById($id, ...)
  + deletePhimById($id)
}

class MovieCategory {
  - id: int <<PK>>
  - title: String
}

class Room {
  - id_room: int <<PK>>
  - ten_phong: String
}

class Calendar {
  - id_calendar: int <<PK>>
  - id_movie: int <<FK>>
  - day: Date
  - id_phong: int <<FK>>
  - time: String
  - gia_ve: BigInt
  --
  + indexNgay($id)
  + indexGio($id, $day)
  + ajax_themngay($id)
  + ajax_xoangay($id)
  + ajax_editngay($id)
  + ajax_themgio($phong, $gio)
  + ajax_xoagio($id)
  + ajax_editgio($id)
}

class Booking {
  - id_ve: int <<PK>>
  - id_user: int <<FK>>
  - id_calendar: int <<FK>>
  - seats: String
  - tong_tien: String
  - status: int (0/1)
  --
  + addBooking($user_id, $cal_id, $seats, $amount)
  + showBooking()
  + showBookingPaginated($limit, $offset)
  + countBooking()
  + getSeat($id_calendar)
  + index_seat($idc)
  + index_thanhtoan()
  + index_ticket()
}

class Comment {
  - id_comment: int <<PK>>
  - id_user: int <<FK>>
  - id_movie: int <<FK>>
  - content: Text
  - rating: int
  - status: int
  - created_at: DateTime
  - updated_at: DateTime
  --
  + getCommentsChuaXuLy($id_movie)
  + getAllComments($id_movie)
  + insertComment($data)
  + updateCommentStatus($id, $status)
  + updateComment($id, $content)
  + deleteComment($id)
  + submitComment()
  + updateCommentAjax()
}

class Payment_Momo {
  - id: int <<PK>>
  - partnerCode: String
  - orderId: String
  - requestId: String
  - amount: String
  - orderInfo: String
  - orderType: String
  - transId: String
  - payType: String
  - signature: String
  --
  + addMomo($data)
}

class Payment_Vnpay {
  - id: int <<PK>>
  - vnp_Amount: String
  - vnp_BankCode: String
  - vnp_BankTranNo: String
  - vnp_CardType: String
  - vnp_OrderInfo: String
  - vnp_PayDate: String
  - vnp_ResponseCode: String
  - vnp_TmnCode: String
  - vnp_TransactionNo: String
  - vnp_TransactionStatus: String
  - vnp_TxnRef: String
  - vnp_SecureHash: String
  --
  + addVnpay($data)
}

class Sentiment {
  - id: int <<PK>>
  - content: Text
  - sentiment_score: float
  - sentiment_type: String
  --
  + analyzeSentiment($text)
}

class AIChatbot {
  + chat()
  + processMessage($message)
  + getRuleBasedResponse($message)
  + getRealAIResponse($message)
  + getOpenAIResponse($message)
  + getHuggingFaceResponse($message)
  + getGeminiResponse($message)
  + getAIResponse($message)
  + detectCategory($message)
  + suggestMoviesByCategory($category)
}

' ===== RELATIONSHIPS =====
User "1" -- "*" Booking : creates
Movie "1" -- "*" Calendar : has
Movie "1" -- "*" Comment : receives
MovieCategory "1" -- "*" Movie : contains
Room "1" -- "*" Calendar : schedules
Calendar "1" -- "*" Booking : contains
Booking "1" -- "0..1" Payment_Momo : paid_with
Booking "1" -- "0..1" Payment_Vnpay : paid_with
Comment "1" -- "0..1" Sentiment : analyzed_by

@enduml
