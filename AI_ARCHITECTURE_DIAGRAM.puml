@startuml AI Architecture Diagram

title Kiáº¿n TrÃºc Há»‡ Thá»‘ng AI - Website Ráº¡p Chiáº¿u Phim

actor "NgÆ°á»i DÃ¹ng" as User
participant "Chatbot UI" as UI
participant "ChatbotController" as Controller
participant "AI Config" as Config
participant "Database" as DB
participant "AI Service\n(Gemini/OpenAI)" as AI
participant "Rule-based\nEngine" as RuleBased

== Luá»“ng ChÃ­nh (AI Mode) ==
User -> UI: Gá»­i tin nháº¯n\n"Vui lÃ²ng cho biáº¿t phim Ä‘ang chiáº¿u"
UI -> Controller: POST /chat\n{message: "..."}
Controller -> Config: get('ai_provider')
Config --> Controller: 'gemini'

Controller -> DB: getDatabasePhimDC()\ngetDatabasePhimSC()
DB --> Controller: Danh sÃ¡ch phim thá»±c táº¿

Controller -> Controller: buildContext()\nTáº¡o prompt vá»›i context
Controller -> AI: callGeminiAPI(prompt)
AI --> Controller: AI Response

alt API Success
    Controller --> UI: JSON {response: "AI tráº£ lá»i..."}
else API Failed (Quota/Network)
    Controller -> RuleBased: getRuleBasedResponse()
    RuleBased --> Controller: Rule-based response
    Controller --> UI: JSON {response: "Rule tráº£ lá»i..."}
end

UI --> User: Hiá»ƒn thá»‹ pháº£n há»“i

== Chi Tiáº¿t Context Building ==
group Context Injection
Controller -> DB: Query phim Ä‘ang chiáº¿u
DB --> Controller: Avengers, Frozen II, Joker...
Controller -> DB: Query phim sáº¯p chiáº¿u
DB --> Controller: Avatar 2, Sonic 3...
Controller -> Controller: Format context\nğŸ¬ PHIM ÄANG CHIáº¾U:\n- Avengers...\n\nâš ï¸ KhÃ´ng Ä‘Æ°á»£c bá»‹a Ä‘áº·t!
end

== Fallback Mechanism ==
note right of Controller
<b>Fallback Logic:</b>
1. Try AI API first
2. If fail â†’ Rule-based
3. If no rule match â†’ Default response
4. Always return something
end note

== Configuration Layer ==
Config -> Config: ai_provider = 'gemini'\napi_key = from env\ntemperature = 0.7\nmax_tokens = 500

== Monitoring ==
Controller -> Controller: Log API calls\nTrack success/failure\nMonitor quota usage

@enduml


