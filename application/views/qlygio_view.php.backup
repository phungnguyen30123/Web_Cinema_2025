<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>quản lý lịch chiếu</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,700' rel='stylesheet' type='text/css'>

    <!-- Mobile menu -->
    <link href="<?php echo base_url() ?>css/gozha-nav.css" rel="stylesheet" />
    <!-- Select -->
    <link href="<?php echo base_url() ?>css/external/jquery.selectbox.css" rel="stylesheet" />
    
    <!-- Custom -->
    <link href="<?php echo base_url() ?>css/themsty.css" rel="stylesheet">
    <link href="<?php echo base_url() ?>css/style.css?v=1" rel="stylesheet" />
    
    <!-- Admin Style CSS -->
    <link href="<?php echo base_url(); ?>css/admin-style.css" rel="stylesheet" />

    <!-- jQuery (required for Bootstrap) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Modernizr --> 
    <script src="<?php echo base_url() ?>js/external/modernizr.custom.js"></script>
    
    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        .hidden-xs-up {
            display: none !important;
        }
        .text-xs-center {
            text-align: center;
        }
        .text-xs-right {
            text-align: right;
        }
        .thaotac {
            margin-bottom: 15px;
        }
        .giochuaedit {
            font-size: 18px;
            font-weight: 500;
            color: #212529;
            padding: 8px 0;
        }
        .form-control.gioedit {
            background: #ffffff;
            border: 1px solid var(--border-color);
        }
        .btn i {
            margin-right: 5px;
        }
        pre {
            margin: 0;
            padding: 0;
            background: transparent;
            border: none;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-4">
                <div class="jumbotron jumbotron-fluid text-xs-center">
                    <div class="container">
                        <h4 class="display-3">Thêm giờ chiếu</h4>
                        <pre></pre>
                        
                        
                        
                        <!--<p class="lead">1/11/2022</p>-->
                    </div>
                </div>
                <!-- <form> -->
                    <fieldset class="form-group phong1">
                        <h4>Phòng 1</h4>
                        <pre></pre>
                        <input type="time" name="gio" id="gio">
                        <a data-href="1" type="button" class="btn btn-success" id="nutthemgiophong1"><i class="fa fa-plus"></i> </a>
                    </fieldset>
                    <!-- <fieldset class="form-group themgphong1"> -->

                        <!-- </fieldset> -->
                        <!-- </form>   -->
                        <pre></pre>

                        <!-- <form> -->
                            <fieldset class="form-group phong2">
                                <h4>Phòng 2</h4>
                                <pre></pre>
                                <input type="time" name="gio" id="gio">
                                <a data-href="2" type="button" class="btn btn-success" id="nutthemgiophong2"><i class="fa fa-plus"></i></a>
                            </fieldset>
                            <!-- <fieldset class="form-group"> -->

                                <!-- </fieldset> -->
                                <!-- </form>   -->



                            </div>
                            <div class="col-sm-8">
                                <div class="jumbotron jumbotron-fluid text-xs-center">
                                    <div class="container">
                                        <?php foreach ($dulieutucontrollerTit as $valuephim): ?>
                                        <input type="hidden" name="id_movie" id="id_movie" value="<?= $valuephim['id'] ?>">
                                        <h3 class="display-5">Phim: <?= $valuephim['title']; ?></h3>


                                        <?php foreach ($daytucontroller as $day): ?>
                                        <h4 class="display-5">Ngày: <?= $day['day'] ?></h1>
                                        <input type="hidden" name="day" id="day" value="<?= $day['day'] ?>">

                                        <?php endforeach ?>

                                            <pre></pre>
                                        </div>
                                    </div>

                                    <div class="panel panel-primary text-center">
                                        <div class="panel-body cacgio1">
                                            <h4>Phòng 1</h4>
                                            <?php foreach ($dulieutucontroller1 as $value1): ?>
                                            
                                            <li class="list-group-item">

                                                <div class="thaotac text-xs-right">

                                                    <a data-href="<?= $value1['id_calendar']; ?>" class="nutedit btn btn-danger"> <i class="fa fa-pencil"></i></a>
                                                    <a data-href="<?= $value1['id_calendar']; ?>" class="nutxoa btn btn-warning"> <i class="fa fa-remove"></i></a>
                                                </div>

                                                <div class="jquery_button text-xs-right hidden-xs-up">

                                                    <a data-href="<?= $value1['id_calendar']; ?>" class="nutluu btn btn-success">LƯU</a>
                                                </div>
                                                <div>
                                                    <div class="jquery_gioedit hidden-xs-up">
                                                        <input type="time" name="gioedit" id="gioedit" class="form-control gioedit" value="<?= $value1['time']; ?>">
                                                    </div>


                                                    <div class="giochuaedit">     
                                                        <?= $value1['time']; ?>
                                                    </div>
                                                </div>


                                                


                                            </li>
                                            <?php endforeach ?>
                                        </div>

                                        <div class="panel-body cacgio2">
                                            <h4>Phòng 2</h4>
                                            <?php foreach ($dulieutucontroller2 as $value2): ?>
                                            
                                            <li class="list-group-item">

                                                <div class="thaotac text-xs-right">

                                                    <a data-href="<?= $value2['id_calendar']; ?>" class="nutedit btn btn-danger"> <i class="fa fa-pencil"></i></a>
                                                    <a data-href="<?= $value2['id_calendar']; ?>" class="nutxoa btn btn-warning"> <i class="fa fa-remove"></i></a>
                                                </div>
                                                <div class="jquery_button text-xs-right hidden-xs-up">

                                                    <a data-href="<?= $value2['id_calendar']; ?>" class="nutluu btn btn-success">LƯU</a>
                                                </div>
                                                <div>
                                                    <div class="jquery_gioedit hidden-xs-up">
                                                        <input type="time" name="gioedit" id="gioedit" class="form-control gioedit">
                                                    </div>


                                                    <div class="giochuaedit">     
                                                    <?= $value2['time']; ?>
                                                </div>
                                                </div>
                                                


                                            </li>
                                            <?php endforeach ?>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <?php endforeach ?>

                        <!-- JavaScript-->
                        <!-- Bootstrap JS -->
                        <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js"></script>
                        <script type="text/javascript" src="<?php echo base_url() ?>1.js"></script>
                        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script> 

                        <script>
                            $(function(){
                                var duongdan = '<?php echo base_url() ?>' ;

                //sự kiện nút giờ
                $('body').on('click', '#nutthemgiophong1', function(event) {
                    id_phong = $(this).data('href');
                    id_movie= $('#id_movie').val();
                    day= $('#day').val();
                    gio = $(this).parent().children('input').val();
                    
                    // Kiểm tra giờ có được nhập không
                    if (!gio) {
                        alert('Vui lòng nhập giờ chiếu!');
                        return;
                    }
                    
                    //console.log(id_phong, id_movie,day,gio);
                    $.ajax({
                        url: duongdan+'index.php/Qlylich_controller/ajax_themgio/'+id_phong+'/'+gio,
                        type: 'POST',
                        dataType: 'json',
                        data: {id_movie,day},
                    })
                    .done(function(response) {
                        // Kiểm tra response từ server
                        if (response && response.success === true) {
                            // Thành công - thêm giờ chiếu mới vào danh sách
                            var id_calendar = response.id_calendar;
                            noidung = '<li class="list-group-item">';
                            noidung += '<div class="thaotac text-xs-right">';
                            noidung += '<a data-href="'+id_calendar+'" class="nutedit btn btn-danger"> <i class="fa fa-pencil"></i></a>';
                            noidung += ' <a data-href="'+id_calendar+'" class="nutxoa btn btn-warning"> <i class="fa fa-remove"></i></a>';
                            noidung += '</div>';
                            noidung += '<div class="jquery_button text-xs-right hidden-xs-up">';
                            noidung += '<a data-href="'+id_calendar+'" class="nutluu btn btn-success">LƯU</a>';
                            noidung += '</div>';
                            noidung += '<div>';
                            noidung += '<div class="jquery_gioedit hidden-xs-up">';
                            noidung += '<input type="time" name="gioedit" id="gioedit" class="form-control gioedit">';
                            noidung += '</div>';
                            noidung += '<div class="giochuaedit">';
                            noidung += gio;
                            noidung += '</div>';
                            noidung += '</div>';
                            noidung += '</li>';
                            $('.cacgio1').append(noidung); // thêm giờ mới vào
                            $('#gio').val(''); // xoa ô input
                        } else {
                            // Lỗi - hiển thị thông báo
                            var errorMsg = response && response.message ? response.message : 'Có lỗi xảy ra khi thêm giờ chiếu!';
                            alert(errorMsg);
                        }
                    })
                    .fail(function(xhr, status, error) {
                        // Xử lý lỗi AJAX
                        console.error('AJAX Error:', status, error);
                        try {
                            var response = JSON.parse(xhr.responseText);
                            if (response && response.message) {
                                alert(response.message);
                            } else {
                                alert('Có lỗi xảy ra khi thêm giờ chiếu!');
                            }
                        } catch(e) {
                            alert('Có lỗi xảy ra khi thêm giờ chiếu!');
                        }
                    });
                });

                $('body').on('click', '#nutthemgiophong2', function(event) {
                    id_phong = $(this).data('href');
                    id_movie= $('#id_movie').val();
                    day= $('#day').val();
                    gio = $(this).parent().children('input').val();
                    
                    // Kiểm tra giờ có được nhập không
                    if (!gio) {
                        alert('Vui lòng nhập giờ chiếu!');
                        return;
                    }
                    
                    //console.log(id_phong, id_movie,day,gio);
                    $.ajax({
                        url: duongdan+'index.php/Qlylich_controller/ajax_themgio/'+id_phong+'/'+gio,
                        type: 'POST',
                        dataType: 'json',
                        data: {id_movie,day},
                    })
                    .done(function(response) {
                        // Kiểm tra response từ server
                        if (response && response.success === true) {
                            // Thành công - thêm giờ chiếu mới vào danh sách
                            var id_calendar = response.id_calendar;
                            noidung = '<li class="list-group-item">';
                            noidung += '<div class="thaotac text-xs-right">';
                            noidung += '<a data-href="'+id_calendar+'" class="nutedit btn btn-danger"> <i class="fa fa-pencil"></i></a>';
                            noidung += ' <a data-href="'+id_calendar+'" class="nutxoa btn btn-warning"> <i class="fa fa-remove"></i></a>';
                            noidung += '</div>';
                            noidung += '<div class="jquery_button text-xs-right hidden-xs-up">';
                            noidung += '<a data-href="'+id_calendar+'" class="nutluu btn btn-success">LƯU</a>';
                            noidung += '</div>';
                            noidung += '<div>';
                            noidung += '<div class="jquery_gioedit hidden-xs-up">';
                            noidung += '<input type="time" name="gioedit" id="gioedit" class="form-control gioedit">';
                            noidung += '</div>';
                            noidung += '<div class="giochuaedit">';
                            noidung += gio;
                            noidung += '</div>';
                            noidung += '</div>';
                            noidung += '</li>';
                            $('.cacgio2').append(noidung); // thêm giờ mới vào
                            $('#gio').val(''); // xoa ô input
                        } else {
                            // Lỗi - hiển thị thông báo
                            var errorMsg = response && response.message ? response.message : 'Có lỗi xảy ra khi thêm giờ chiếu!';
                            alert(errorMsg);
                        }
                    })
                    .fail(function(xhr, status, error) {
                        // Xử lý lỗi AJAX
                        console.error('AJAX Error:', status, error);
                        try {
                            var response = JSON.parse(xhr.responseText);
                            if (response && response.message) {
                                alert(response.message);
                            } else {
                                alert('Có lỗi xảy ra khi thêm giờ chiếu!');
                            }
                        } catch(e) {
                            alert('Có lỗi xảy ra khi thêm giờ chiếu!');
                        }
                    });
                });

                //bắt đầu jquery nút xoá
                $('body').on('click', '.nutxoa', function(event) {
                    id_calendar = $(this).data('href');
                    doituongcanxoa = $(this).parent().parent();
                    $.ajax({
                        url: duongdan + 'index.php/Qlylich_controller/ajax_xoagio/' + id_calendar,
                        type: 'POST',
                        dataType: 'json',
                        data: {}
                    })
                    .done(function() {
                    //    console.log("success");
                })
                    .fail(function() {
                    //    console.log("error");
                })
                    .always(function() {
                        console.log("complete");
                        doituongcanxoa.remove();
                    });
                    
                }); //hết jquery nút xoá

                $('body').on('click', '.nutedit', function(event) {
                    //ẩn nội dung cũ
                    $(this).parent().addClass('hidden-xs-up');
                    $(this).parent().next().next().find('.giochuaedit').addClass('hidden-xs-up');

                    //hiện phần tử mới
                    $(this).parent().next().removeClass('hidden-xs-up');
                    $(this).parent().next().next().find('.jquery_gioedit').removeClass('hidden-xs-up');
                    event.preventDefault();

                });

                $('body').on('click', '.nutluu', function(event) {
                    id_calendar = $(this).data('href');
                    
                    //ẩn đi
                    
                    gioedit= $(this).parent().next().children('.jquery_gioedit').children().val();
                    phantu1 = $(this).parent().addClass('hidden-xs-up');
                    phantu2 = $(this).parent().next().children('.jquery_gioedit').addClass('hidden-xs-up');

                    noidung = $(this).parent().next().children('.jquery_gioedit').children('.gioedit').val();

                    //hiển thị lại
                    hienthi1 = $(this).parent().prev().removeClass('hidden-xs-up');
                    hienthi2 = $(this).parent().next().children('.giochuaedit').removeClass('hidden-xs-up');
                    hienthi3 = $(this).parent().next().children('.giochuaedit').html(noidung).removeClass('hidden-xs-up');

                    $.ajax({
                        url: duongdan+'index.php/Qlylich_controller/ajax_editgio/'+id_calendar,
                        type: 'POST',
                        dataType: 'json',
                        data: {gioedit},
                    })
                    .done(function() {
                        console.log("success");
                    })
                    .fail(function() {
                        console.log("error");
                    })
                    .always(function() {
                        console.log("complete");
                    });
                    event.preventDefault();
                    



                });
            })


        </script>
  <script src="<?php echo base_url(); ?>js/admin-sidebar.js"></script>


    </body>
    </html>